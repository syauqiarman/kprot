{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Mahasiswa</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
    <div class="grid grid-cols-3 gap-4">
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="text-xl font-bold">Clock</h2>
            <p class="mt-2 text-lg font-semibold">Day <span id="clock">00.00.00</span></p>
        </div>

        <div class="col-span-2 bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-bold mb-3">Daftar Mahasiswa - {{ semester.nama }}</h2>
            <form method="get" class="mb-4 flex gap-4">
                <input type="text" name="angkatan" placeholder="Masukkan Angkatan" value="{{ request.GET.angkatan }}" class="border p-2 rounded w-1/3">
                <select name="program" class="border p-2 rounded w-1/3">
                    <option value="">-- Pilih Program --</option>
                    <option value="KP" {% if request.GET.program == "KP" or request.GET.program == "kp" %}selected{% endif %}>KP</option>
                    <option value="MBKM" {% if request.GET.program == "MBKM" or request.GET.program == "mbkm" %}selected{% endif %}>MBKM</option>
                </select>
                <label for="status">Status:</label>
                <select name="status">
                    <option value="">Semua</option>
                    <option value="Menunggu Detil" {% if request.GET.status == "Menunggu Detil" %}selected{% endif %}>Menunggu Detil</option>
                    <option value="Terdaftar" {% if request.GET.status == "Terdaftar" %}selected{% endif %}>Terdaftar</option>
                    <option value="Menunggu Persetujuan PA" {% if request.GET.status == "Menunggu Persetujuan PA" %}selected{% endif %}>Menunggu Persetujuan PA</option>
                    <option value="Ditolak PA" {% if request.GET.status == "Ditolak PA" %}selected{% endif %}>Ditolak PA</option>
                    <option value="Menunggu Persetujuan Kaprodi" {% if request.GET.status == "Menunggu Persetujuan Kaprodi" %}selected{% endif %}>Menunggu Persetujuan Kaprodi</option>
                    <option value="Ditolak Kaprodi" {% if request.GET.status == "Ditolak Kaprodi" %}selected{% endif %}>Ditolak Kaprodi</option>
                    <option value="Menunggu Verifikasi Dosen" {% if request.GET.status == "Menunggu Verifikasi Dosen" %}selected{% endif %}>Menunggu Verifikasi Dosen</option>
                    <option value="Ditolak Dosen" {% if request.GET.status == "Ditolak Dosen" %}selected{% endif %}>Ditolak Dosen</option>
                </select>
                <button type="submit" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">Filter</button>
            </form>

            <table class="w-full border rounded-lg">
                <thead class="bg-gray-700 text-white">
                    <tr>
                        <th class="py-2 px-3">NPM</th>
                        <th class="py-2 px-3">Nama</th>
                        <th class="py-2 px-3">Program</th>
                        <th class="py-2 px-3">Status</th>
                    </tr>
                </thead>
                <tbody class="bg-white">
                    {% for mahasiswa in filter.qs %}
                    <tr class="border-b">
                        <td class="py-2 px-3">{{ mahasiswa.npm }}</td>
                        <td class="py-2 px-3">{{ mahasiswa.nama }}</td>
                        <td>
                            {% with mahasiswa.pendaftarankp_set.first as kp %}
                            {% with mahasiswa.pendaftaranmbkm_set.first as mbkm %}
                                {% if kp and mbkm %}
                                    KP, MBKM
                                {% elif kp %}
                                    KP
                                {% elif mbkm %}
                                    MBKM
                                {% else %}
                                    Tidak Terdaftar
                                {% endif %}
                            {% endwith %}
                            {% endwith %}
                        </td>
                        <td class="py-2 px-3"> 
                        {% with mahasiswa.pendaftarankp_set.first as kp %}
                            {{ kp.status_pendaftaran|default:"-" }}
                        {% endwith %}                        
                    </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="py-2 text-center">Tidak ada data</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function updateClock() {
            let now = new Date();
            let timeString = now.getHours().toString().padStart(2, '0') + ":" + 
                            now.getMinutes().toString().padStart(2, '0') + ":" + 
                            now.getSeconds().toString().padStart(2, '0');
            document.getElementById("clock").innerText = timeString;
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>